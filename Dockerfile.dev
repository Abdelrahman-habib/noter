# Development Dockerfile with all project tools
FROM golang:1.25.1-alpine AS dev

# Install build dependencies and development tools
RUN apk add --no-cache git ca-certificates tzdata make bash curl

# Set working directory
WORKDIR /app

# Copy go mod files
COPY go.mod go.sum go.tool.mod ./

# Download dependencies
RUN go mod download

# Download tool dependencies
RUN go mod download -modfile=go.tool.mod

# Install goose and project tools
RUN go install github.com/pressly/goose/v3/cmd/goose@latest && \
    go install -modfile=go.tool.mod golang.org/x/vuln/cmd/govulncheck && \
    go install -modfile=go.tool.mod honnef.co/go/tools/cmd/staticcheck

# Copy source code
COPY . .

# Build the application
RUN go build -o bin/snippetbox ./cmd/web

# Expose port
EXPOSE 4444

# Default command for development
CMD ["./bin/snippetbox"]